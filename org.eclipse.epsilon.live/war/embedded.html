<html>
  <head>
    <script src="codemirror/js/codemirror.js" type="text/javascript"></script>
    <script src="codemirror/js/mirrorframe.js" type="text/javascript"></script>
    
    <script type="text/javascript">
	    
	    var http = createRequestObject();

	    function createRequestObject() {
	    	var objAjax;
	    	var browser = navigator.appName;
	    	if(browser == "Microsoft Internet Explorer"){
	    		objAjax = new ActiveXObject("Microsoft.XMLHTTP");
	    	}else{
	    		objAjax = new XMLHttpRequest();
	    	}
	    	return objAjax;
	    }

	    function run(){

			var url = "evaluate?source=" + encodeURIComponent(source_editor.getCode());

	    	http.open("get", url);
	    	
	    	http.onreadystatechange = updateNewContent;
	    	http.send(null);
	    	return false;
	    }

	    function updateNewContent(){
	    	
	    	if(http.readyState == 4){
	    		
	    		var response;
	    			
	    		if (http.status == "200") {
	    			response = http.responseText;			
	    		}
	    		else {
	    			response = "An unexpected error occurred. Sorry :(";
	    		}
				
	    		console.setCode(response);
	    		//document.getElementById("console_area").innerHTML = response;
	    		//editAreaLoader.setValue('console_area', response);
	    		//document.getElementById("console_area").scrollTop = document.getElementById("console_area").scrollHeight;
	    	}
	    }

	</script>
  </head>
  <body style="background-color:#FFFFFF">
  		<div id="midcolumn"> 
	  		<img src="images/header.gif" style="position:absolute;top:8px"></img>
			<input type="image" style="position:absolute;top:10px;left:412px" label="Run" src="images/run.gif" onClick="javascript:run()"></input>
  			<div id="source_div" style="position:absolute;top:32px;height:350px;width:491px;border:1px solid #B5B4B8; border-top:0px;">
			<textarea id="source_area" style="height:100%;width:100%">-- In this script, we query Ecore to find out:

-- ... how many classes it has
EClass.all.size().println('All classes: ');

-- ... how many abstract classes it has
EClass.all.select(c|c.abstract)
    .size().println('Abstract classes: ');

-- ... the names of its classes and how many 
-- features each one has
'Class names: '.println();
for (c in EClass.all) {
    var toPrint := ' ' + c.name;
    toPrint := toPrint + '->' + 
        c.eStructuralFeatures.size();

    toPrint.println();
}</textarea>
			</div>
			<br>
			<img src="images/console.gif" style="position:absolute;top:410"></img>
			<div id="console_div" style="position:absolute;top:434;height:150px;width:491px;border:1px solid #B5B4B8; border-top:0px;">
			<textarea id="console_area" style="height:100%;width:100%"/></textarea>
			</div>
		</div>
		
		<script type="text/javascript">
			

			
		  	var source_area = document.getElementById('source_area');
			var source_editor = new CodeMirror(CodeMirror.replace(source_area), {
				  parserfile: ["tokenizejavascript.js", "parsejavascript.js"],
				  path: "codemirror/js/",
				  stylesheet: "codemirror/css/jscolors2.css",
				  height: "345px",
				  width:"485px",
				  tabMode:"spaces",
				  content: document.getElementById("source_area").value
				});
			var console_area = document.getElementById('console_area');
			var console = new CodeMirror(CodeMirror.replace(console_area), {
				  parserfile: ["tokenizejavascript.js", "parsejavascript.js"],
				  path: "codemirror/js/",
				  stylesheet: "codemirror/css/nocolors.css",
				  height:"145px",
				  width:"485px",
				  readOnly:true,
				  content: document.getElementById("console_area").value
				  
				});
			
			var internetExplorer = document.selection && window.ActiveXObject && /MSIE/.test(navigator.userAgent);
			if (internetExplorer) {
				document.getElementById("console_div").style.width = 493;
				document.getElementById("source_div").style.width = 493;
				//window.alert(document.getElementById("console_div").style.width);
			}
		</script>

  </body>
</html>