<html>
  <head>
    <link href="windows_js/themes/default.css" rel="stylesheet" type="text/css" />
	<link href="windows_js/themes/alphacube.css" rel="stylesheet" type="text/css"/>
	<link href="windows_js/themes/darkX.css" rel="stylesheet" type="text/css"/>
	<link href="windows_js/themes/lighting.css" rel="stylesheet" type="text/css"/>
	<script language="Javascript" type="text/javascript" src="edit_area/edit_area_full.js"></script>
	<link rel="StyleSheet" href="dtree/dtree.css" type="text/css" />
	<script type="text/javascript" src="dtree/dtree.js"></script>		
    <script type="text/javascript" src="windows_js/javascripts/prototype.js"> </script>
    <script type="text/javascript" src="windows_js/javascripts/window.js"></script>
    
    <script type="text/javascript">
	    function init() {
	        var source = new Window('S', {className : "greylighting", top:100, left:350, width: 400, height: 300, zIndex:150, resizable: true, title: "Source"});
	        source.setContent("source");
			source.setConstraint(true, {left:0, right:0, top: 0, bottom:0})
	        source.show();

			/*
	        var examples = new Window('E', {className : "greylighting", top:100, left:100, width:220, height: 550, zIndex:151, resizable: true, title: "Examples"});
	        examples.setContent("examples");
	        examples.setConstraint(true, {left:0, right:0, top: 0, bottom:0})
	        examples.show();

	        var about = new Window('A', {className : "greylighting", top:100, left:780, width:220, height: 550, zIndex:151, resizable: true, title: "About Epsilon Live!"});
	        about.setContent("about");
	        about.setConstraint(true, {left:0, right:0, top: 0, bottom:0})
	        about.show();
	        */
	        
	        var console = new Window('C', {className : "greylighting", top:450, left:350, width:400, height: 200, zIndex:151, resizable: true, title: "Console"});
	        console.setContent("console");
	        console.setConstraint(true, {left:0, right:0, top: 0, bottom:0})
	        console.show();
	        
			/*
			editAreaLoader.init({
				id: "source_area"	// id of the textarea to transform	
				,start_highlight: true	
				,font_size: "11"
				,font_family: "courier, monospace"
				,allow_resize: "no"
				,allow_toggle: false
				,language: "en"
				,syntax: "css"	
				,toolbar: "new_document, save, load, |, charmap, |, search, go_to_line, |, undo, redo, |, select_font, |, change_smooth_selection, highlight, reset_highlight, |, help"
				,load_callback: "my_load"
				,save_callback: "my_save"
				,plugins: "charmap"
				,charmap_default: "arrows"
					
			});

			editAreaLoader.init({
				id: "console_area"	// id of the textarea to transform	
				,start_highlight: false	
				,font_size: "11"
				,font_family: "courier, monospace"
				,allow_resize: "no"
				,allow_toggle: false
				,language: "en"
				,syntax: "css"
				,toolbar: "select_font"
			});
			*/
		}

	    var http = createRequestObject();

	    function createRequestObject() {
	    	var objAjax;
	    	var browser = navigator.appName;
	    	if(browser == "Microsoft Internet Explorer"){
	    		objAjax = new ActiveXObject("Microsoft.XMLHTTP");
	    	}else{
	    		objAjax = new XMLHttpRequest();
	    	}
	    	return objAjax;
	    }

	    function run(){

			var url = "tryepsilon?source=" + encodeURIComponent(editAreaLoader.getValue("source_area"));

	    	http.open("get", url);
	    	
	    	http.onreadystatechange = updateNewContent;
	    	http.send(null);
	    	return false;
	    }

	    function updateNewContent(){
	    	
	    	if(http.readyState == 4){
	    		
	    		var response;
	    			
	    		if (http.status == "200") {
	    			response = http.responseText;			
	    		}
	    		else {
	    			response = "An unexpected error occurred. Sorry :(";
	    		}

	    		//document.getElementById("console_area").innerHTML = response;
	    		editAreaLoader.setValue('console_area', response);
	    		//document.getElementById("console_area").scrollTop = document.getElementById("console_area").scrollHeight;
	    	}
	    }

		function doIt() {
			document.getElementById('console_area').innerHTML = "foo";
		}

		function setSelectionRange(input, selectionStart, selectionEnd) {
			  if (input.setSelectionRange) {
			    input.focus();
			    input.setSelectionRange(selectionStart, selectionEnd);
			  }
			  else if (input.createTextRange) {
			    var range = input.createTextRange();
			    range.collapse(true);
			    range.moveEnd('character', selectionEnd);
			    range.moveStart('character', selectionStart);
			    range.select();
			  }
			}

			function replaceSelection (input, replaceString) {
				if (input.setSelectionRange) {
					var selectionStart = input.selectionStart;
					var selectionEnd = input.selectionEnd;
					input.value = input.value.substring(0, selectionStart)+ replaceString + input.value.substring(selectionEnd);
			    
					if (selectionStart != selectionEnd){ 
						setSelectionRange(input, selectionStart, selectionStart + 	replaceString.length);
					}else{
						setSelectionRange(input, selectionStart + replaceString.length, selectionStart + replaceString.length);
					}

				}else if (document.selection) {
					var range = document.selection.createRange();

					if (range.parentElement() == input) {
						var isCollapsed = range.text == '';
						range.text = replaceString;

						 if (!isCollapsed)  {
							range.moveStart('character', -replaceString.length);
							range.select();
						}
					}
				}
			}


			// We are going to catch the TAB key so that we can use it, Hooray!
			function catchTab(item,e){
				if(navigator.userAgent.match("Gecko")){
					c=e.which;
				}else{
					c=e.keyCode;
				}
				if(c==9){
					replaceSelection(item,String.fromCharCode(9));
					setTimeout("document.getElementById('"+item.id+"').focus();",0);	
					return false;
				}
					    
			}
			
	</script>
  </head>
  <body onload="init()" style="background-color:#EFEFEF">
		<div id="source">
			<input type="image" label="Run" src="images/run.gif" onClick="javascript:run()"></input>
			<div>
				<textarea id="source_area" onkeydown="return catchTab(this,event)" style="height:89%;width:100%"></textarea><br>
			</div>
		</div>
		<!--
    	<div id="examples" style="width:100%;height:100%;background-color:white">
			<div class="dtree">
						
				<script type="text/javascript">
					
					d = new dTree('d');
			
					d.add(0,-1,'My example tree');
					d.add(1,0,'Node 1','example01.html');
					d.add(2,0,'Node 2','example01.html');
					d.add(3,1,'Node 1.1','example01.html');
					d.add(4,0,'Node 3','example01.html');
					d.add(5,3,'Node 1.1.1','example01.html');
					d.add(6,5,'Node 1.1.1.1','example01.html');
					d.add(7,0,'Node 4','example01.html');
					d.add(8,1,'Node 1.2','example01.html');
					d.add(9,0,'My Pictures','example01.html','Pictures I\'ve taken over the years','','','img/imgfolder.gif');
					d.add(10,9,'The trip to Iceland','example01.html','Pictures of Gullfoss and Geysir');
					d.add(11,9,'Mom\'s birthday','example01.html');
					d.add(12,0,'Recycle Bin','example01.html','','','img/trash.gif');
			
					document.write(d);
			
					
				</script>
			
			</div>
    	</div>
    	<div id="about" style="width:100%;height:100%;background-color:white">
    		Here go all the about stuff...
    	</div>
    	-->
    	<div id="console">
			<textarea id="console_area" style="width:100%;height:99%;border:0px;"/></textarea>
		</div>   
  </body>
</html>


